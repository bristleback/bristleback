<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>bristle-core.js - Bristleback Client API</title>
    <link rel="stylesheet" href="http:&#x2F;&#x2F;yui.yahooapis.com&#x2F;3.7.0&#x2F;build&#x2F;cssgrids&#x2F;cssgrids-min.css">
    <link rel="stylesheet" href="..&#x2F;assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="..&#x2F;assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="..&#x2F;assets/favicon.png">
    <script src="http:&#x2F;&#x2F;yui.yahooapis.com&#x2F;combo?3.7.0&#x2F;build&#x2F;yui&#x2F;yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="http:&#x2F;&#x2F;bristleback.pl&#x2F;img&#x2F;bristleback-logo-green.png" title="Bristleback Client API"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 0.3.0</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="..&#x2F;classes/Bristleback.auth.SystemAuthentication.html">Bristleback.auth.SystemAuthentication</a></li>
            
                <li><a href="..&#x2F;classes/Bristleback.Client.html">Bristleback.Client</a></li>
            
                <li><a href="..&#x2F;classes/Bristleback.Console.html">Bristleback.Console</a></li>
            
                <li><a href="..&#x2F;classes/Bristleback.controller.Action.html">Bristleback.controller.Action</a></li>
            
                <li><a href="..&#x2F;classes/Bristleback.controller.ActionCallback.html">Bristleback.controller.ActionCallback</a></li>
            
                <li><a href="..&#x2F;classes/Bristleback.controller.ActionClass.html">Bristleback.controller.ActionClass</a></li>
            
                <li><a href="..&#x2F;classes/Bristleback.controller.ActionController.html">Bristleback.controller.ActionController</a></li>
            
                <li><a href="..&#x2F;classes/Bristleback.controller.ActionExceptionHandler.html">Bristleback.controller.ActionExceptionHandler</a></li>
            
                <li><a href="..&#x2F;classes/Bristleback.controller.ActionMessage.html">Bristleback.controller.ActionMessage</a></li>
            
                <li><a href="..&#x2F;classes/Bristleback.controller.ClientActionClass.html">Bristleback.controller.ClientActionClass</a></li>
            
                <li><a href="..&#x2F;classes/Bristleback.controller.controllers.html">Bristleback.controller.controllers</a></li>
            
                <li><a href="..&#x2F;classes/Bristleback.LOCAL_HOSTNAME.html">Bristleback.LOCAL_HOSTNAME</a></li>
            
                <li><a href="..&#x2F;classes/Bristleback.template.TemplateController.html">Bristleback.template.TemplateController</a></li>
            
                <li><a href="..&#x2F;classes/Bristleback.USER_CONTEXT.html">Bristleback.USER_CONTEXT</a></li>
            
                <li><a href="..&#x2F;classes/Bristleback.USER_DETAILS.html">Bristleback.USER_DETAILS</a></li>
            
                <li><a href="..&#x2F;classes/Bristleback.utils.html">Bristleback.utils</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="..&#x2F;modules/auth.html">auth</a></li>
            
                <li><a href="..&#x2F;modules/Bristleback.html">Bristleback</a></li>
            
                <li><a href="..&#x2F;modules/controller.html">controller</a></li>
            
                <li><a href="..&#x2F;modules/core.html">core</a></li>
            
                <li><a href="..&#x2F;modules/serialization.html">serialization</a></li>
            
                <li><a href="..&#x2F;modules/template.html">template</a></li>
            
                <li><a href="..&#x2F;modules/utils.html">utils</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: bristle-core.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
&#x2F;**
 Core module

 @module Bristleback
 @submodule core
 @main Bristleback
 **&#x2F;

&#x2F;**
 * This class is a WebSocket connection abstraction. It uses WebSocket object to connect and communicate with the server.
 * Single Client object represents a single client-server connection. There can be multiple instances of this class
 * (there can be multiple connections from single browser tab).
 * @class Client
 * @namespace Bristleback
 * @param config configuration object.
 *&#x2F;
Bristleback.Client = function (config) {
  this.connection = undefined;

  config = config || {};

  config.serverUrl = config.serverUrl || Bristleback.LOCAL_HOSTNAME;
  config.serializationEngine = config.serializationEngine || &quot;json&quot;;
  config.dataController = config.dataController || &quot;system.controller.action&quot;;
  config.timeout = config.timeout || 360000;
  config.developmentConsole = config.developmentConsole || false;

  this.dataController = new Bristleback.controller.controllers[config.dataController]();
  this.dataController.client = this;

  this.serializationEngine = new Bristleback.serialization.serializationEngines[config.serializationEngine]();

  config.onOpen = config.onOpen || function () {
    Bristleback.Console.log(&quot;Connected to &quot; + config.serverUrl);
    alert(&quot;connected&quot;);
  };

  config.onClose = config.onClose || function () {
    Bristleback.Console.log(&quot;Disconnected from &quot; + config.serverUrl);
    alert(&quot;disconnected&quot;);
  };

  var thisClient = this;
  config.onMessage = config.onMessage || function (event) {
    var deserializedEvent = thisClient.serializationEngine.deserialize(event.data);
    thisClient.dataController.onMessage(deserializedEvent);
  };

  this.configuration = config;
};

&#x2F;**
 * Gets current client connection state. The returned value is equals to the one of fallowing fields:
 *
 *  * WebSocket.CONNECTING
 *  * WebSocket.OPEN
 *  * WebSocket.CLOSING
 *  * WebSocket.CLOSED
 *  @method getConnectionState
 *&#x2F;
Bristleback.Client.prototype.getConnectionState = function () {
  if (!this.connection) {
    return WebSocket.CLOSED;
  }
  return this.connection.readyState;
};

&#x2F;**
 * Checks whether this client is connected (has connection state equals to WebSocket.OPEN).
 * @method isConnected
 *&#x2F;
Bristleback.Client.prototype.isConnected = function () {
  return this.getConnectionState() == WebSocket.OPEN;
};

&#x2F;**
 * Checks whether this client is disconnected (has connection state equals to WebSocket.CLOSED).
 * @method isDisconnected
 *&#x2F;
Bristleback.Client.prototype.isDisconnected = function () {
  return this.getConnectionState() == WebSocket.CLOSED;
};

&#x2F;**
 * Connects to remote server using configuration passed as constructor parameter.
 * If connection is not closed in the moment of connection, exception is thrown.
 * @method connect
 *&#x2F;
Bristleback.Client.prototype.connect = function () {
  if (!this.isDisconnected()) {
    var msg = &quot;Connection is not closed, cannot establish another connection.&quot;;
    Bristleback.Console.log(msg);
    throw new Error(msg);
  }
  this.connection = new WebSocket(this.configuration.serverUrl, this.configuration.dataController);
  this.connection.onopen = this.configuration.onOpen;
  this.connection.onmessage = this.configuration.onMessage;
  this.connection.onclose = this.configuration.onClose;
};

&#x2F;**
 * Sends a message to remote server. Message is serialized using client serialization engine.
 * This method should generally be not used by application creator. Instead, data controller should be user.
 * @method sendMessage
 * @param message message object to send.
 *&#x2F;
Bristleback.Client.prototype.sendMessage = function (message) {
  if (!this.isConnected()) {
    var msg = &quot;Cannot send a message, connection is not open.&quot;;
    Bristleback.Console.log(msg);
    throw new Error(msg);
  }
  var serializedMessage = this.serializationEngine.serialize(message);
  this.connection.send(serializedMessage);
};

&#x2F;**
 * Disconnects client from remote server.
 * If connection is not open, exception is thrown.
 * @method disconnect
 *&#x2F;
Bristleback.Client.prototype.disconnect = function () {
  if (!this.isConnected()) {
    var msg = &quot;Connection is not open, it may be already closed or in closing state. Actual state: &quot; + this.getConnectionState();
    Bristleback.Console.log(msg);
    throw new Error(msg);
  }
  this.connection.close();
};

&#x2F;**
 * Creates a new instance of client, using passed configuration object.
 * @method newClient
 * @static
 * @param config
 *&#x2F;
Bristleback.newClient = function (config) {
  return new Bristleback.Client(config);
};
    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="..&#x2F;assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="..&#x2F;assets/js/yui-prettify.js"></script>
<script src="..&#x2F;assets/../api.js"></script>
<script src="..&#x2F;assets/js/api-filter.js"></script>
<script src="..&#x2F;assets/js/api-list.js"></script>
<script src="..&#x2F;assets/js/api-search.js"></script>
<script src="..&#x2F;assets/js/apidocs.js"></script>
</body>
</html>
